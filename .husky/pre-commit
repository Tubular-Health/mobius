#!/bin/sh

# Run Biome on staged files
npx biome check --staged --no-errors-on-unmatched

# Check if package.json is staged for commit
if git diff --cached --name-only | grep -q "^package\.json$"; then
  # Verify package-lock.json is in sync
  npm install --package-lock-only --ignore-scripts 2>/dev/null

  if ! git diff --quiet package-lock.json; then
    echo "Error: package-lock.json is out of sync with package.json"
    echo "Run 'npm install' and stage the updated lock file"
    git checkout package-lock.json 2>/dev/null
    exit 1
  fi
fi
